(function(e){function r(e){if(e in t.style){return e}var n=["Moz","Webkit","O","ms"];var r=e.charAt(0).toUpperCase()+e.substr(1);if(e in t.style){return e}for(var i=0;i<n.length;++i){var s=n[i]+r;if(s in t.style){return s}}}function i(){t.style[n.transform]="";t.style[n.transform]="rotateY(90deg)";return t.style[n.transform]!==""}function f(e){if(typeof e==="string"){this.parse(e)}return this}function l(e,t,n){if(t===true){e.queue(n)}else{if(t){e.queue(t,n)}else{n()}}}function c(t){var n=[];e.each(t,function(t){t=e.camelCase(t);t=e.transit.propertyMap[t]||e.cssProps[t]||t;t=d(t);if(e.inArray(t,n)===-1){n.push(t)}});return n}function h(t,n,r,i){var s=c(t);if(e.cssEase[r]){r=e.cssEase[r]}var o=""+m(n)+" "+r;if(parseInt(i,10)>0){o+=" "+m(i)}var u=[];e.each(s,function(e,t){u.push(t+" "+o)});return u.join(", ")}function p(t,r){if(!r){e.cssNumber[t]=true}e.transit.propertyMap[t]=n.transform;e.cssHooks[t]={get:function(n){var r=e(n).css("transit:transform");return r.get(t)},set:function(n,r){var i=e(n).css("transit:transform");i.setFromString(t,r);e(n).css({"transit:transform":i})}}}function d(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function v(e,t){if(typeof e==="string"&&!e.match(/^[\-0-9\.]+$/)){return e}else{return""+e+t}}function m(t){var n=t;if(e.fx.speeds[n]){n=e.fx.speeds[n]}return v(n,"ms")}e.transit={version:"0.9.9",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:true,useTransitionEnd:false};var t=document.createElement("div");var n={};var s=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;n.transition=r("transition");n.transitionDelay=r("transitionDelay");n.transform=r("transform");n.transformOrigin=r("transformOrigin");n.transform3d=i();var o={transition:"transitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"};var u=n.transitionEnd=o[n.transition]||null;for(var a in n){if(n.hasOwnProperty(a)&&typeof e.support[a]==="undefined"){e.support[a]=n[a]}}t=null;e.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(.6,.04,.98,.335)",linear:"cubic-bezier(1,1,1,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"};e.cssHooks["transit:transform"]={get:function(t){return e(t).data("transform")||new f},set:function(t,r){var i=r;if(!(i instanceof f)){i=new f(i)}if(n.transform==="WebkitTransform"&&!s){t.style[n.transform]=i.toString(true)}else{t.style[n.transform]=i.toString()}e(t).data("transform",i)}};e.cssHooks.transform={set:e.cssHooks["transit:transform"].set};if(e.fn.jquery<"1.8"){e.cssHooks.transformOrigin={get:function(e){return e.style[n.transformOrigin]},set:function(e,t){e.style[n.transformOrigin]=t}};e.cssHooks.transition={get:function(e){return e.style[n.transition]},set:function(e,t){e.style[n.transition]=t}}}p("scale");p("translate");p("rotate");p("rotateX");p("rotateY");p("rotate3d");p("perspective");p("skewX");p("skewY");p("x",true);p("y",true);f.prototype={setFromString:function(e,t){var n=typeof t==="string"?t.split(","):t.constructor===Array?t:[t];n.unshift(e);f.prototype.set.apply(this,n)},set:function(e){var t=Array.prototype.slice.apply(arguments,[1]);if(this.setter[e]){this.setter[e].apply(this,t)}else{this[e]=t.join(",")}},get:function(e){if(this.getter[e]){return this.getter[e].apply(this)}else{return this[e]||0}},setter:{rotate:function(e){this.rotate=v(e,"deg")},rotateX:function(e){this.rotateX=v(e,"deg")},rotateY:function(e){this.rotateY=v(e,"deg")},scale:function(e,t){if(t===undefined){t=e}this.scale=e+","+t},skewX:function(e){this.skewX=v(e,"deg")},skewY:function(e){this.skewY=v(e,"deg")},perspective:function(e){this.perspective=v(e,"px")},x:function(e){this.set("translate",e,null)},y:function(e){this.set("translate",null,e)},translate:function(e,t){if(this._translateX===undefined){this._translateX=0}if(this._translateY===undefined){this._translateY=0}if(e!==null&&e!==undefined){this._translateX=v(e,"px")}if(t!==null&&t!==undefined){this._translateY=v(t,"px")}this.translate=this._translateX+","+this._translateY}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},scale:function(){var e=(this.scale||"1,1").split(",");if(e[0]){e[0]=parseFloat(e[0])}if(e[1]){e[1]=parseFloat(e[1])}return e[0]===e[1]?e[0]:e},rotate3d:function(){var e=(this.rotate3d||"0,0,0,0deg").split(",");for(var t=0;t<=3;++t){if(e[t]){e[t]=parseFloat(e[t])}}if(e[3]){e[3]=v(e[3],"deg")}return e}},parse:function(e){var t=this;e.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(e,n,r){t.setFromString(n,r)})},toString:function(e){var t=[];for(var r in this){if(this.hasOwnProperty(r)){if(!n.transform3d&&(r==="rotateX"||r==="rotateY"||r==="perspective"||r==="transformOrigin")){continue}if(r[0]!=="_"){if(e&&r==="scale"){t.push(r+"3d("+this[r]+",1)")}else{if(e&&r==="translate"){t.push(r+"3d("+this[r]+",0)")}else{t.push(r+"("+this[r]+")")}}}}}return t.join(" ")}};e.fn.transition=e.fn.transit=function(t,r,i,s){var o=this;var a=0;var f=true;if(typeof r==="function"){s=r;r=undefined}if(typeof i==="function"){s=i;i=undefined}if(typeof t.easing!=="undefined"){i=t.easing;delete t.easing}if(typeof t.duration!=="undefined"){r=t.duration;delete t.duration}if(typeof t.complete!=="undefined"){s=t.complete;delete t.complete}if(typeof t.queue!=="undefined"){f=t.queue;delete t.queue}if(typeof t.delay!=="undefined"){a=t.delay;delete t.delay}if(typeof r==="undefined"){r=e.fx.speeds._default}if(typeof i==="undefined"){i=e.cssEase._default}r=m(r);var c=h(t,r,i,a);var p=e.transit.enabled&&n.transition;var d=p?parseInt(r,10)+parseInt(a,10):0;if(d===0){var v=function(e){o.css(t);if(s){s.apply(o)}if(e){e()}};l(o,f,v);return o}var y={};var b=function(r){var i=false;var a=function(){if(i){o.unbind(u,a)}if(d>0){o.each(function(){this.style[n.transition]=y[this]||null})}if(typeof s==="function"){s.apply(o)}if(typeof r==="function"){r()}};if(d>0&&u&&e.transit.useTransitionEnd){i=true;o.bind(u,a)}else{window.setTimeout(a,d)}o.each(function(){if(d>0){this.style[n.transition]=c}e(this).css(t)})};var w=function(e){this.offsetWidth;b(e)};l(o,f,w);return this};e.transit.getTransitionValue=h})(jQuery);(function(){function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var r=e.prototype,i=this,s=i.EventEmitter;r.getListeners=function(e){var t,n,r=this._getEvents();if("object"==typeof e){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;e.length>t;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,n){var r,i=this.getListenersAsObject(e),s="object"==typeof n;for(r in i)i.hasOwnProperty(r)&&-1===t(i[r],n)&&i[r].push(s?n:{listener:n,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,n){var r,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&(r=t(s[i],n),-1!==r&&s[i].splice(r,1));return this},r.off=n("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if("object"===n)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(e,t){var n,r,i,s,o=this.getListenersAsObject(e);for(i in o)if(o.hasOwnProperty(i))for(r=o[i].length;r--;)n=o[i][r],n.once===!0&&this.removeListener(e,n.listener),s=n.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},r.trigger=n("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=s,e},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.EventEmitter=e}).call(this),function(e){function t(t){var n=e.event;return n.target=n.target||n.srcElement||t,n}var n=document.documentElement,r=function(){};n.addEventListener?r=function(e,t,n){e.addEventListener(t,n,!1)}:n.attachEvent&&(r=function(e,n,r){e[n+r]=r.handleEvent?function(){var n=t(e);r.handleEvent.call(r,n)}:function(){var n=t(e);r.call(e,n)},e.attachEvent("on"+n,e[n+r])});var i=function(){};n.removeEventListener?i=function(e,t,n){e.removeEventListener(t,n,!1)}:n.detachEvent&&(i=function(e,t,n){e.detachEvent("on"+t,e[t+n]);try{delete e[t+n]}catch(r){e[t+n]=void 0}});var s={bind:r,unbind:i};"function"==typeof define&&define.amd?define("eventie/eventie",s):e.eventie=s}(this),function(e,t){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(n,r){return t(e,n,r)}):"object"==typeof exports?module.exports=t(e,require("eventEmitter"),require("eventie")):e.imagesLoaded=t(e,e.EventEmitter,e.eventie)}(this,function(e,t,n){function r(e,t){for(var n in t)e[n]=t[n];return e}function i(e){return"[object Array]"===h.call(e)}function s(e){var t=[];if(i(e))t=e;else if("number"==typeof e.length)for(var n=0,r=e.length;r>n;n++)t.push(e[n]);else t.push(e);return t}function o(e,t,n){if(!(this instanceof o))return new o(e,t);"string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=s(e),this.options=r({},this.options),"function"==typeof t?n=t:r(this.options,t),n&&this.on("always",n),this.getImages(),f&&(this.jqDeferred=new f.Deferred);var i=this;setTimeout(function(){i.check()})}function u(e){this.img=e}function a(e){this.src=e,p[e]=this}var f=e.jQuery,l=e.console,c=l!==void 0,h=Object.prototype.toString;o.prototype=new t,o.prototype.options={},o.prototype.getImages=function(){this.images=[];for(var e=0,t=this.elements.length;t>e;e++){var n=this.elements[e];"IMG"===n.nodeName&&this.addImage(n);for(var r=n.querySelectorAll("img"),i=0,s=r.length;s>i;i++){var o=r[i];this.addImage(o)}}},o.prototype.addImage=function(e){var t=new u(e);this.images.push(t)},o.prototype.check=function(){function e(e,i){return t.options.debug&&c&&l.log("confirm",e,i),t.progress(e),n++,n===r&&t.complete(),!0}var t=this,n=0,r=this.images.length;if(this.hasAnyBroken=!1,!r)return this.complete(),void 0;for(var i=0;r>i;i++){var s=this.images[i];s.on("confirm",e),s.check()}},o.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;var t=this;setTimeout(function(){t.emit("progress",t,e),t.jqDeferred&&t.jqDeferred.notify&&t.jqDeferred.notify(t,e)})},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var t=this;setTimeout(function(){if(t.emit(e,t),t.emit("always",t),t.jqDeferred){var n=t.hasAnyBroken?"reject":"resolve";t.jqDeferred[n](t)}})},f&&(f.fn.imagesLoaded=function(e,t){var n=new o(this,e,t);return n.jqDeferred.promise(f(this))}),u.prototype=new t,u.prototype.check=function(){var e=p[this.img.src]||new a(this.img.src);if(e.isConfirmed)return this.confirm(e.isLoaded,"cached was confirmed"),void 0;if(this.img.complete&&void 0!==this.img.naturalWidth)return this.confirm(0!==this.img.naturalWidth,"naturalWidth"),void 0;var t=this;e.on("confirm",function(e,n){return t.confirm(e.isLoaded,n),!0}),e.check()},u.prototype.confirm=function(e,t){this.isLoaded=e,this.emit("confirm",this,t)};var p={};return a.prototype=new t,a.prototype.check=function(){if(!this.isChecked){var e=new Image;n.bind(e,"load",this),n.bind(e,"error",this),e.src=this.src,this.isChecked=!0}},a.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},a.prototype.onload=function(e){this.confirm(!0,"onload"),this.unbindProxyEvents(e)},a.prototype.onerror=function(e){this.confirm(!1,"onerror"),this.unbindProxyEvents(e)},a.prototype.confirm=function(e,t){this.isConfirmed=!0,this.isLoaded=e,this.emit("confirm",this,t)},a.prototype.unbindProxyEvents=function(e){n.unbind(e.target,"load",this),n.unbind(e.target,"error",this)},o});var W3Ex=W3Ex||{};jQuery(document).ready(function(){W3Ex.ibaengine=function(e){function w(t){if(t=="layer"){if(p.layer==-1){e(c.newtext).attr("disabled","disabled");e(c.previewlayer).attr("disabled","disabled");e(c.deletelayer).attr("disabled","disabled")}else{e(c.newtext).removeAttr("disabled");var n=E(p.layer);if(n.length==0)e(c.previewlayer).attr("disabled","disabled");else e(c.previewlayer).removeAttr("disabled");e(c.deletelayer).removeAttr("disabled")}}if(t=="state"){if(p.state==-1){e("#statesettings").tabs().hide()}else{e("#statesettings").tabs().show()}}}function E(e){var t=[];for(var n=0;n<r.states.items.length;n++){if(!P(r.states.items[n]))continue;var i=r.states.items[n];if(i.layerid!=e)continue;t.push(i)}return t}function S(e){return!e||!/\S/.test(e)}function x(){var t;var n=e("#usestyles");for(var r=0;r<i.items.length;r++){t=i.items[r];if(t==undefined)continue;if(t.id==undefined)continue;n.append("<option value='"+t.id+"'>"+t.name+"</option>");if(t.id>=h.style){h.style=t.id;h.style++}}e("#updatestyle, #renamestyle, #deletestyle").attr("disabled","disabled")}function T(){var t=C(p.layer);e("#statescontainer").empty();if(t==undefined)return;for(var n=0;n<t.length;n++){var r=t[n];if(r==undefined)continue;if(r.stateid>=h.state){h.state=r.stateid;h.state++}for(var i=0;i<t.length;i++){var o=t[i];if(o.sortid==n){var u="Text State";var a='<li data-id="'+o.stateid+'" class="ui-state-highlight layerstate">'+u+'<button class="btn btn-danger btn-sm" type="button" title="Delete State">'+'<span class="glyphicon glyphicon-trash"></span>'+"</button></li>";e("#statescontainer").append(a);break}}}var f=s[p.layer];if(f==undefined)return;if(f.selstate==-1)return;var l='<div class="selstatediv"></div>';e("li.layerstate").removeClass("selstate").find(e("div")).remove();e("li.layerstate[data-id="+f.selstate+"]").addClass("selstate").append(l);p.state=f.selstate;M(p.layer,p.state);w("state")}function N(t,n,r){if(t==-1||n==-1)return;r=typeof r!=="undefined"?r:false;var i=C(t,n);if(p.state!=-1){i.text=e("#statecontent").val();i.displayfor=e("#displaystate").val();i.delayfor=e("#delaystate").val();i.afterfin=e("#laststatefin option:selected").val();i.onappear=e("#onappeartype option:selected").val();i.onappeareasing=e("#onappeareasing option:selected").val();i.onappearspeed=e("#onappearspeed").val();i.ondisappear=e("#ondisappeartype").val();i.ondisappeareasing=e("#ondisappeareasing option:selected").val();i.ondisappearspeed=e("#ondisappearspeed").val();i.staticeffect="none"}if(r){var s=C(t);e("li.layerstate").each(function(t){var n=e(this).attr("data-id");for(var r=0;r<s.length;r++){var i=s[r];if(i.stateid!=n)continue;i.sortid=t;break}})}}function C(e,t,n,i){n=typeof n!=="undefined"?n:false;i=typeof i!=="undefined"?i:false;t=typeof t!=="undefined"?t:-1;var s=[];if(r.states==undefined){r.states={};r.states.items=[]}for(var o=0;o<r.states.items.length;o++){if(r.states.items[o]==undefined)continue;if(r.states.items[o].layerid!=e)continue;if(i){delete r.states.items[o];continue}if(t==-1){s.push(r.states.items[o]);continue}if(r.states.items[o].stateid!=t)continue;if(n){delete r.states.items[o];return}return r.states.items[o]}if(i){for(var u=0;u<r.layers.items.length;u++){if(r.layers.items[u]==undefined)continue;if(r.layers.items[u].id!=e)continue;delete r.layers.items[u];break}return}if(t==-1){return s}var a={};a.layerid=e;a.stateid=t;a.type="text";a.text="";r.states.items.push(a);return a}function k(t,n,r,i){var s;s=t.toHexString();e("#fontexample").css("background",s);e("#back-color-value").val(s)}function L(t){var n;n=t.toHexString();e("#fontexample").css("color",n);e("#font-color-value").val(n)}function A(){if(e("#newtextstate").length){p.layer=-1;e("#statescontainer").sortable({cursor:"move",start:function(t,n){N(p.layer,p.state);var r='<div class="selstatediv"></div>';e("li.layerstate").removeClass("selstate").find(e("div")).remove();n.item.addClass("selstate").append(r);var i=n.item.attr("data-id");p.state=i;M(p.layer,p.state);w("state")}}).disableSelection();e("#statesettings").tabs();e("#statesettings").tabs().hide();w("layer");i.items=[];O();if(r.layers==undefined){r.layers={};r.layers.items=[];r.states={};r.states.items=[]}x();var n=e("#fontexample");e("#slider-font-size").slider({range:"min",value:15,min:8,max:82,slide:function(t,r){e("#font-size").val(r.value+"px");n.css("font-size",r.value+"px")}});e("#slider-radius-size").slider({range:"min",value:10,min:0,max:50,slide:function(t,r){e("#radius-size").val(r.value+"px");n.css("border-radius",r.value+"px")}});e("#slider-padding-size").slider({range:"min",value:0,min:0,max:20,slide:function(t,r){e("#padding-size").val(r.value+"px");n.css("padding",r.value+"px")}});e("#radius-size").val(e("#slider-radius-size").slider("value")+"px");e("#padding-size").val(e("#slider-padding-size").slider("value")+"px");n.css("border-radius",e("#slider-radius-size").slider("value")+"px");e("#font-color-value").val("#000000");e("#back-color-value").val("#ffffff");e("#showdialog").dialog({autoOpen:false,height:640,width:780,modal:true,draggable:false,resizable:false,closeOnEscape:false,open:function(n,r){var i=e(".ui-dialog:visible");e(i).css("z-index",300002);e(".ui-widget-overlay").each(function(){e(this).next(".ui-dialog").andSelf().wrapAll('<div class="w3exvtfscope w3exvtfdel" />')});e("span.ui-icon-closethick").css({left:"0px",top:"0px"});var s=e("#fontexample");e("#font-size").val(e("#slider-font-size").slider("value")+"px");s.css("font-size",e("#slider-font-size").slider("value")+"px");var o="#000000";var u="#ffffff";e("#back-color").spectrum({color:u,className:"full-spectrum",appendTo:"#showdialog",showPalette:true,showInput:true,showSelectionPalette:true,maxPaletteSize:10,preferredFormat:"hex",change:k,palette:t});e("#font-color").spectrum({color:o,className:"full-spectrum",appendTo:"#showdialog",showPalette:true,showInput:true,showSelectionPalette:true,maxPaletteSize:10,preferredFormat:"hex",change:L,palette:t});var a=C(p.layer,p.state);m={};if(P(a)&&P(a.style)){m.fontsize=a.style.fontsize;m.fontcolor=a.style.fontcolor;m.fontfamily=a.style.fontfamily;m.ifbackground=a.style.ifbackground;if(a.style.ifbackground){m.backcolor=a.style.backcolor;m.radiussize=a.style.radiussize;m.padding=a.style.padding}e("#font-size").val(m.fontsize+"px");e("#font-family").val(m.fontfamily);s.css("font-size",m.fontsize+"px");e("#slider-font-size").slider("value",m.fontsize);e("#font-color").spectrum("set",m.fontcolor);e("#font-color-value").val(m.fontcolor);s.css("color",m.fontcolor);s.css("font-family",m.fontfamily);if(m.ifbackground){e("#divifbackground").css("visibility","visible");e("#ifbackground").prop("checked",true);s.css("background",m.backcolor);e("#back-color").spectrum("set",m.backcolor);e("#slider-radius-size").slider("value",m.radiussize);e("#back-color-value").val(m.backcolor);e("#radius-size").val(m.radiussize+"px");e("#slider-padding-size").slider("value",m.padding);e("#padding-size").val(m.padding+"px");s.css("border-radius",m.radiussize+"px");s.css("padding",m.padding+"px")}else{s.css("background","");e("#back-color").spectrum("set","#ffffff");e("#slider-radius-size").slider("value",0);e("#slider-padding-size").slider("value",0);e("#padding-size").val("0px");e("#back-color-value").val(u);e("#radius-size").val("0px");s.css("border-radius","0px");s.css("padding","0px");e("#ifbackground").prop("checked",false);e("#divifbackground").css("visibility","hidden")}}else{e("#font-size").val("15px");s.css("font-size","15px");e("#slider-font-size").slider("value",15);e("#font-color-value").val(o);s.css("color",o);s.css("font-family","");s.css("background","");s.css("padding","0px");e("#back-color-value").val(u);e("#slider-radius-size").slider("value",0);e("#radius-size").val("0px");s.css("border-radius","0px");e("#ifbackground").prop("checked",false);e("#divifbackground").css("visibility","hidden")}},close:function(t,n){e("#font-color").spectrum("destroy");e("#back-color").spectrum("destroy");e("#updatestyle, #renamestyle, #deletestyle").attr("disabled","disabled");e("#usestyles").val("none")},buttons:{OK:function(){var t=C(p.layer,p.state);if(P(t)){if(!P(t.style))t.style={};t.style.fontsize=e("#slider-font-size").slider("value");t.style.fontcolor=e("#font-color-value").val();t.style.fontfamily=e("#font-family").val();t.style.ifbackground=e("#ifbackground").prop("checked");if(t.style.ifbackground){t.style.backcolor=e("#back-color-value").val();t.style.radiussize=e("#slider-radius-size").slider("value");t.style.padding=e("#slider-padding-size").slider("value")}M(p.layer,p.state)}e(this).dialog("close")},Cancel:function(){e(this).dialog("close")}}})}}function O(){if(W3Ex.imagearrlayers!=undefined){r=W3Ex.imagearrlayers;if(r.layers!=undefined){for(var t=0;t<r.layers.items.length;t++){var n=r.layers.items[t];if(n.id==undefined){r.layers.items.splice(t,1);t--;continue}var o=n.id;if(h.layer<=o){h.layer=o;h.layer++}var u='<div data-id="'+o+'" class="defaultlayer layer imagelayer defaultstyle"> Layer<br/>'+"</div>";e("#w3_ibacontainer0").append(u);var a=e("#w3_ibacontainer0 > div:last");a.draggable({containment:"parent",start:function(){var t=e(this).attr("data-id");if(p.layer==t||b.ispreview)return;N(p.layer,p.state,true);var n=s[p.layer];if(n==undefined){n={};s[p.layer]=n}n.selstate=p.state;p.state=-1;h.state=0;e(".layer").removeClass("selected");e(this).addClass("selected");p.layer=t;v=e(this);w("layer");w("state");T()}});a.css("top",parseInt(n.top));a.css("left",parseInt(n.left))}}}if(W3Ex.arrstyles!=undefined&&W3Ex.arrstyles.items!=undefined){for(var f=0;f<W3Ex.arrstyles.items.length;f++){var l=W3Ex.arrstyles.items[f];if(l==undefined){W3Ex.arrstyles.items.splice(f,1);f--;continue}if(l.id==undefined){W3Ex.arrstyles.items.splice(f,1);f--;continue}}i=W3Ex.arrstyles}}function M(t,n){if(t==-1||n==-1)return;var r=C(t,n);e("#changestyle").removeAttr("disabled");e("#contenttype").text("Text");e("#statecontentdiv").removeClass("ui-nobackground ui-widget ui-state-default ui-corner-all");e("#statecontentdiv").hide();e("#editcontent").hide();e("#statecontent").show();e("#statecontent").val(r.text.replace(new RegExp("<br />","g"),"\n"));r.text=r.text.replace(new RegExp("\n","g"),"<br />");v.html(r.text);v.removeClass("defaultstyle");if(P(r.style)){var i=r.style;v.css({"font-size":i.fontsize+"px",color:i.fontcolor,"font-family":i.fontfamily});if(i.ifbackground==="true")i.ifbackground=true;if(i.ifbackground==="false")i.ifbackground=false;if(i.ifbackground){v.css({background:i.backcolor,"border-radius":i.radiussize+"px",padding:i.padding+"px"})}else{v.css({background:"","border-radius":"",padding:"0px"})}}else{v.css({"font-size":"15px",color:"#000000",background:"","border-radius":"",padding:"0px"})}if(P(r.displayfor))e("#displaystate").val(r.displayfor);else e("#displaystate").val(4e3);if(P(r.delayfor))e("#delaystate").val(r.delayfor);else e("#delaystate").val(0);if(P(r.afterfin))e("#laststatefin").val(r.afterfin);else e("#laststatefin").val("loop");if(P(r.onappear))e("#onappeartype").val(r.onappear);else e("#onappeartype").val("fadein");if(P(r.onappeareasing))e("#onappeareasing").val(r.onappeareasing);else e("#onappeareasing").val("ease");if(P(r.onappearspeed))e("#onappearspeed").val(r.onappearspeed);else e("#onappearspeed").val(500);if(P(r.ondisappear))e("#ondisappeartype").val(r.ondisappear);else e("#ondisappeartype").val("fadeout");if(P(r.ondisappeareasing))e("#ondisappeareasing").val(r.ondisappeareasing);else e("#ondisappeareasing").val("ease");if(P(r.ondisappearspeed))e("#ondisappearspeed").val(r.ondisappearspeed);else e("#ondisappearspeed").val(500)}function _(t){v.html("");if(t=="text"){e("#contenttype").text("Text");e("#statecontentdiv").removeClass("ui-nobackground ui-widget ui-state-default ui-corner-all");e("#statecontentdiv").hide();e("#editcontent").hide();e("#statecontent").show();e("#statecontent").val("");e("#changestyle").removeAttr("disabled")}v.removeClass("defaultstyle");v.css({"font-size":"15px",color:"#000000",background:"","border-radius":"",padding:"0px"});e("#displaystate").val(4e3);e("#delaystate").val(0);e("#laststatefin").val("loop");e("#onappeartype").val("fadein");e("#onappeareasing").val("ease");e("#onappearspeed").val(500);e("#ondisappeartype").val("fadeout");e("#ondisappeareasing").val("ease");e("#ondisappearspeed").val(500)}function P(e){return e!==a}function H(e){var t=F(e);var r={visibility:"hidden"};t.domitem.css(r);n.push(t)}function B(e){var t={};var n=e.domitem;t.duration=e.onappspeed;t.complete=j;var r=false;var i=e.width;var s=Math.round(i/2);var o=e.height;var u=Math.round(o/2);if(e.state.start&&!e.state.finish){t.easing=e.onappeasing;n.css({top:e.top+"px",left:e.left+"px",visibility:"visible",opacity:0,transition:"",transform:""});switch(e.onappear){case"fadein":{t.opacity=1}break;case"top":{n.css({top:e.top-y+"px"});t.top=e.top+"px";t.opacity=1}break;case"left":{n.css({left:e.left-y+"px"});t.left=e.left+"px";t.opacity=1}break;case"right":{n.css({left:e.left+y+"px"});t.left=e.left+"px";n.css({height:e.height+"px"});t.opacity=1}break;case"bottom":{n.css({top:e.top+y+"px"});t.top=e.top+"px";t.opacity=1}break;default:break}}else if(e.state.finish){n.css({top:e.top+"px",left:e.left+"px",transition:"",transform:""});t.duration=e.ondisspeed;t.easing=e.ondiseasing;switch(e.ondis){case"fadeout":{t.opacity=0}break;case"top":{t.top=e.top-y+"px";t.opacity=0}break;case"left":{t.left=e.left-y+"px";t.opacity=0}break;case"right":{t.left=e.left+y+"px";t.opacity=0}break;case"bottom":{t.top=e.top+y+"px";t.opacity=0}break;case"none":{t.duration=10;t.opacity=0}break;default:break}}if(e.state.firstshow){e.state.firstshow=false;e.state.start=true;e.state.finish=false;t.delay=e.delayfor;n.transition(t)}else{if(e.state.finish){t.delay=e.displayfor;n.transition(t)}else{t.delay=0;n.transition(t)}}}function j(t){var t=typeof t!=="undefined"?t:-1;if(!b.ispreview)return;var r;if(t!=-1){r=t}else r=e(this).attr("id");for(var i=0;i<n.length;i++){var s=n[i];if(s.domid==r){if(t!=-1){B(s);return}if(s.state.start){s.state.start=false;s.state.finish=true;if(R(s)){if(s.afterfin=="stop")return}B(s)}else if(s.state.finish){var o=s.domitem;o.css({top:s.top+"px",left:s.left+"px",transform:"",transition:"",opacity:0,visibility:"hidden"});var u;var a=U(s);u=a.anim;s.state.start=false;s.state.finish=false;s.state.curritem=false;u.state.start=true;u.state.curritem=true;u.state.finish=false;B(u)}break}}}function F(t){var n={};var r=e("#w3_effect"+t.stateid+"-"+b.counter);n.domitem=r;var i={start:false,finish:false,curritem:false,isfirst:false,islast:false,firstshow:false};n.state=i;n.domid=r.attr("id");n.width=parseInt(r.outerWidth(),10);n.height=r.outerHeight();n.sortid=parseInt(t.sortid,10);n.layerid=0;n.layerdom=b.layer.domitem;n.delayfor=parseInt(t.delayfor,10);n.displayfor=parseInt(t.displayfor,10);n.afterfin=t.afterfin;n.onappear=t.onappear;n.onappeasing=t.onappeareasing;n.onappspeed=parseInt(t.onappearspeed,10);n.ondis=t.ondisappear;n.ondiseasing=t.ondisappeareasing;n.ondisspeed=parseInt(t.ondisappearspeed,10);n.staticeffect="none";var s=b.layer;if(s.width<n.width){s.width=n.width}if(s.height<n.height){s.height=n.height}r.css({position:"absolute",display:"inline",width:n.width+"px",height:n.height+"px"});return n}function I(){var t=b.layer;var r=e("#mainimage");if(r.width()>r.height())y=parseInt(r.width()*.14,10);else y=parseInt(r.height()*.14,10);var i=b.arrstates;for(var s=0;s<i.length;s++){var o=i[s];H(o)}t.domitem.removeClass("w3_ibainnerhold");t.domitem.css({position:"absolute",top:t.top,left:t.left,width:t.width,height:t.height});for(var u=0;u<n.length;u++){var a=n[u];if(a.height<t.height){a.domitem.css("top",Math.round((t.height-a.height)/2)+"px")}if(a.width<t.width){a.domitem.css("left",Math.round((t.width-a.width)/2)+"px")}a.left=a.domitem.position().left;a.top=a.domitem.position().top}for(var s=0;s<n.length;s++){var a=n[s];if(a.sortid==0){a.state.start=true;a.state.finish=false;a.state.curritem=true;a.state.isfirst=true;a.state.firstshow=true;a.state.islast=R(a);B(a);break}}}function q(){var t=0;var r=0;n.length=0;b.counter++;e('<div id="w3_previewlayer" class="w3_ibainnerhold"></div>').appendTo(e("#w3_ibacontainer0"));b.layer.domitem=e("#w3_previewlayer");var i=b.arrstates;for(var s=0;s<i.length;s++){var o=i[s];e('<div style="position: absolute;left:0px;top:0px;display:inline;" data-id="'+o.stateid+'" id="w3_effect'+o.stateid+"-"+b.counter+'" class="w3_effect"></div>').appendTo(b.layer.domitem);var u=e("#w3_effect"+o.stateid+"-"+b.counter);o.text=o.text.replace(new RegExp("\n","g"),"<br />");u.html(o.text);if(P(o.style)){var a=o.style;u.css({"font-size":a.fontsize+"px",color:a.fontcolor,"font-family":a.fontfamily});if(a.ifbackground==="true")a.ifbackground=true;if(a.ifbackground==="false")a.ifbackground=false;if(a.ifbackground){u.css({background:a.backcolor,"border-radius":a.radiussize+"px",padding:a.padding+"px"})}else{u.css({background:"","border-radius":"",padding:"0px"})}}else{u.css({"font-size":"15px",color:"#000000",background:"","border-radius":"",padding:"0px"})}}if(document.getElementById("w3_previewlayer")){imagesLoaded(document.getElementById("w3_previewlayer"),function(e){I()})}else I()}function R(e){for(var t=0;t<n.length;t++){var r=n[t];if(r.sortid>e.sortid){return false}}return true}function U(e){var t={};t.islast=false;t.isfirst=false;t.anim=e;var r=false;for(var i=0;i<n.length;i++){var s=n[i];if(s.sortid-e.sortid==1){t.anim=s;r=true;break}}var o=false;for(var u=0;u<n.length;u++){var a=n[u];if(a.sortid==0){if(!r){t.anim=a;t.isfirst=true}}else{o=true}}if(!o)t.islast=true;return t}var t=[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]];var n=[];var r={};var i={};var s=[];var o=0;var u=0;var a;var f={type:"#onappeartype",easing:"#onappeareasing",speed:"#onappearspeed"};var l={type:"#ondisappeartype",easing:"#ondisappeareasing",speed:"#ondisappearspeed"};var c={newlayer:"#newlayer",newtext:"#newtextstate",newhtml:"#newhtmlstate",newimage:"#newimagestate",previewlayer:"#previewlayer",deletelayer:"#deletelayer"};var h={layer:0,state:0,style:0};var p={layer:-1,state:-1};var d=[];var v;var m={};var g="";var y=40;var b={};b.ispreview=false;b.counter=0;e(c.previewlayer).click(function(){if(p.layer==-1)return;var t=e(this).text();if(t.indexOf("Preview Layer")!=-1){e(this).html('<span class="glyphicon glyphicon-stop"></span>'+" Exit Preview</button>");e(this).removeClass("btn-success").addClass("btn-warning");e("#maindiv").hide();e(c.newlayer).attr("disabled","disabled");e(c.deletelayer).attr("disabled","disabled");b.ispreview=true;var i={};i.id=p.layer;b.arrstates=E(p.layer);if(p.state==-1){if(b.arrstates.length>0){N(p.layer,b.arrstates[0].stateid,true)}}else{N(p.layer,p.state,true)}i.top=v.position().top;i.left=v.position().left;i.width=0;i.height=0;b.layer=i;for(var s=0;s<r.layers.items.length;s++){var i=r.layers.items[s];if(i==undefined)continue;var o=e('.layer[data-id="'+i.id+'"]');if(o.length){o.hide()}}q()}else{e(this).html('<span class="glyphicon glyphicon-play"></span>'+" Preview Layer</button>");e(this).removeClass("btn-warning").addClass("btn-success");e("#maindiv").show();e(c.deletelayer).removeAttr("disabled");e(c.newlayer).removeAttr("disabled");b.ispreview=false;for(var u=0;u<n.length;u++){var a=n[u];a.domitem.dequeue();a.domitem.css({"transition-timing-function":"","transition-delay":"","transition-duration":"","transition-property":""})}var f=document.getElementById("w3_previewlayer");f.innerHTML="";n.splice(0,n.length);e("#w3_previewlayer").remove();for(var s=0;s<r.layers.items.length;s++){var i=r.layers.items[s];if(i==undefined)continue;var o=e('.layer[data-id="'+i.id+'"]');if(o.length){o.show()}}}});e("#changestyle").click(function(){N(p.layer,p.state,false);e("#showdialog").dialog("open")});e("#updatestyle").click(function(){var t=e("#usestyles").val();if(t=="none")return;var n;for(var r=0;r<i.items.length;r++){n=i.items[r];if(n==undefined)continue;if(n.id==t){n.fontsize=e("#slider-font-size").slider("value");n.fontcolor=e("#font-color-value").val();n.fontfamily=e("#font-family").val();if(e("#ifbackground").prop("checked")){n.ifbackground=true;n.backcolor=e("#back-color-value").val();n.radiussize=e("#slider-radius-size").slider("value");n.padding=e("#slider-padding-size").slider("value")}else{n.ifbackground=false}break}}var s=e(this);s.addClass("disabled").css("position","relative").append('<div class="showajax"></div>');var o={};o.action="ibeffects_ajax_request";o.type="savestyle";o.nonce=W3ExIBA.nonce;var u={};u.styles=i;o.data=u;jQuery.ajax({type:"post",dataType:"json",url:W3ExIBA.ajaxurl,data:o,complete:function(e){s.removeClass("disabled").css("position","static");s.find(".showajax").remove()}})});e("#renamestyle").click(function(){var t=e("#usestyles").val();var n=e("#renamestylename").val();if(S(n))return;if(t=="none")return;var r;for(var s=0;s<i.items.length;s++){r=i.items[s];if(r==undefined)continue;if(r.id==t){r.name=n;break}}var o=e(this);o.addClass("disabled").css("position","relative").append('<div class="showajax"></div>');var u={};u.action="ibeffects_ajax_request";u.type="savestyle";u.nonce=W3ExIBA.nonce;var a={};a.styles=i;u.data=a;jQuery.ajax({type:"post",dataType:"json",url:W3ExIBA.ajaxurl,data:u,complete:function(t){o.removeClass("disabled").css("position","static");o.find(".showajax").remove();e("#usestyles option:selected").text(n);e("#renamestylename").val("")}})});e("#deletestyle").click(function(){var t=e("#usestyles").val();if(t=="none")return;var n;for(var r=0;r<i.items.length;r++){n=i.items[r];if(n==undefined)continue;if(n.id==t){delete i.items[r];break}}var s=e(this);s.addClass("disabled").css("position","relative").append('<div class="showajax"></div>');var o={};o.action="ibeffects_ajax_request";o.type="savestyle";o.nonce=W3ExIBA.nonce;var u={};u.styles=i;o.data=u;jQuery.ajax({type:"post",dataType:"json",url:W3ExIBA.ajaxurl,data:o,complete:function(t){s.removeClass("disabled").css("position","static");s.find(".showajax").remove();e("#usestyles option:selected").remove()}})});e("#newstyle").click(function(){var t=e("#newstylename").val();if(S(t))t="untitled";var n=e(this);n.addClass("disabled").css("position","relative").append('<div class="showajax"></div>');var r={};r.name=t;r.id=h.style;r.fontsize=e("#slider-font-size").slider("value");r.fontcolor=e("#font-color-value").val();r.fontfamily=e("#font-family").val();if(e("#ifbackground").prop("checked")){r.ifbackground=true;r.backcolor=e("#back-color-value").val();r.radiussize=e("#slider-radius-size").slider("value");r.padding=e("#slider-padding-size").slider("value")}else{r.ifbackground=false}h.style++;i.items.push(r);var s={};s.action="ibeffects_ajax_request";s.type="savestyle";s.nonce=W3ExIBA.nonce;var o={};o.styles=i;s.data=o;jQuery.ajax({type:"post",dataType:"json",url:W3ExIBA.ajaxurl,data:s,complete:function(t){n.removeClass("disabled").css("position","static");n.find(".showajax").remove();e("#usestyles").append("<option value='"+r.id+"'>"+r.name+"</option>");e("#usestyles").val(r.id);e("#updatestyle, #renamestyle, #deletestyle").removeAttr("disabled");e("#newstylename").val("")}})});e("#ifbackground").click(function(t){if(e("#ifbackground").prop("checked")){e("#divifbackground").css("visibility","visible");e("#fontexample").css("background",e("#back-color-value").val());e("#fontexample").css("border-radius",e("#slider-radius-size").slider("value"))}else{e("#divifbackground").css("visibility","hidden");e("#fontexample").css("background","");e("#fontexample").css("border-radius","")}});e("#usestyles").change(function(){var t=e(this).val();var n=e("#fontexample");if(t=="none"){e("#updatestyle, #renamestyle, #deletestyle").attr("disabled","disabled");e("#ifbackground").prop("checked",false);e("#divifbackground").css("visibility","hidden");n.css("background","");e("#slider-font-size").slider("value",15);e("#font-size").val("15px");e("#slider-padding-size").slider("value",0);e("#padding-size").val("0px");n.css("padding","0px");e("#font-color").spectrum("set","#000000");e("#font-color-value").val("#000000");n.css("color","#000000");n.css("font-size","15px");return}e("#updatestyle, #renamestyle, #deletestyle").removeAttr("disabled");var r;for(var s=0;s<i.items.length;s++){r=i.items[s];if(r==undefined)continue;if(r.id==undefined)continue;if(r.id==t){e("#slider-font-size").slider("value",r.fontsize);e("#font-size").val(r.fontsize+"px");e("#font-family").val(r.fontfamily);n.css("font-family",r.fontfamily);e("#font-color").spectrum("set",r.fontcolor);e("#font-color-value").val(r.fontcolor);n.css("color",r.fontcolor);n.css("font-size",r.fontsize+"px");if(r.ifbackground){e("#ifbackground").prop("checked",true);e("#divifbackground").css("visibility","visible");e("#back-color").spectrum("set",r.backcolor);e("#back-color-value").val(r.backcolor);e("#slider-radius-size").slider("value",r.radiussize);e("#radius-size").val(r.radiussize+"px");e("#slider-padding-size").slider("value",r.padding);e("#padding-size").val(r.padding+"px");n.css("padding",r.padding+"px");n.css("border-radius",r.radiussize+"px");n.css("background",r.backcolor)}else{e("#ifbackground").prop("checked",false);e("#divifbackground").css("visibility","hidden");n.css("background","");n.css("padding","0px")}break}}});e(document).on("click","div.imagelayer",function(){var t=e(this).attr("data-id");if(p.layer==t||b.ispreview)return;N(p.layer,p.state,true);var n=s[p.layer];if(n==undefined){n={};s[p.layer]=n}n.selstate=p.state;p.state=-1;h.state=0;e(".layer").removeClass("selected");e(this).addClass("selected");p.layer=t;v=e(this);w("layer");w("state");T()});e("#deletelayer").click(function(){if(p.layer==-1)return;C(p.layer,0,false,true);e('#w3_ibacontainer0 > div[data-id="'+p.layer+'"]').remove();p.layer=-1;p.state=-1;e("#statescontainer").empty();w("layer");w("state")});e("#savechanges").click(function(){if(r.layers.items.length==0)return;N(p.layer,p.state,true);for(var t=0;t<r.layers.items.length;t++){var n=r.layers.items[t];if(n==undefined)continue;var i=e('.layer[data-id="'+n.id+'"]');if(i.length){n.top=i.position().top;n.left=i.position().left}}var s=e(this);s.addClass("disabled").css("position","relative").append('<div class="showajax"></div>');var o={};o.action="ibeffects_ajax_request";o.type="savechanges";o.nonce=W3ExIBA.nonce;var u={};u.id=W3Ex.imageid;u.layers=r;if(P(r.states.items)&&P(r.layers.items)){u.layercount=0;u.statecount=0;for(var t=0;t<r.states.items.length;t++){if(!P(r.states.items[t]))continue;if(!P(r.states.items[t].layerid))continue;var a=r.states.items[t];if(a.type=="html"){a.html=a.html.replace(/\\"/g,'"')}u.statecount++}for(var f=0;f<r.layers.items.length;f++){if(!P(r.layers.items[f]))continue;u.layercount++}}o.data=u;jQuery.ajax({type:"post",dataType:"json",url:W3ExIBA.ajaxurl,data:o,complete:function(e){s.removeClass("disabled").css("position","static");s.find(".showajax").remove()}})});e("#newlayer").click(function(){N(p.layer,p.state,true);if(p.layer!=-1){var t=s[p.layer];if(t==undefined){t={};s[p.layer]=t}t.selstate=p.state}p.state=-1;h.state=0;var n=h.layer;h.layer++;var i='<div data-id="'+n+'" class="defaultlayer layer imagelayer defaultstyle">Empty Layer<br/>'+'<div style="font-size:12px;">/todo: add states/</div>'+"</div>";var o={};o.id=n;r.layers.items.push(o);e("#w3_ibacontainer0").append(i);e("#w3_ibacontainer0 > div:last").draggable({containment:"parent",start:function(){var t=e(this).attr("data-id");if(p.layer==t||b.ispreview)return;N(p.layer,p.state,true);var n=s[p.layer];if(n==undefined){n={};s[p.layer]=n}n.selstate=p.state;p.state=-1;h.state=0;e(".layer").removeClass("selected");e(this).addClass("selected");p.layer=t;v=e(this);w("layer");w("state");T()}})});e(document).on("click","li.layerstate > button",function(t){var n=e(this).parent().attr("data-id");C(p.layer,n,true);if(n==p.state){p.state=-1;_("text");w("state")}e(this).parent().remove();w("layer");t.stopPropagation()});e(document).on("click","li.layerstate",function(){N(p.layer,p.state);var t=e(this).attr("data-id");var n='<div class="selstatediv"></div>';e("li.layerstate").removeClass("selstate").find(e("div")).remove();e(this).addClass("selstate").append(n);p.state=t;M(p.layer,p.state);w("state")});e("#statecontent").keyup(function(){var t=e(this).val();t=t.replace(new RegExp("\n","g"),"<br />");v.html(t)});(function(){e("#newtextstate").click(function(){N(p.layer,p.state);var t=h.state;h.state++;var n='<div class="selstatediv"></div>';var r='<li data-id="'+t+'" class="ui-state-highlight layerstate" >Text State<button class="btn btn-danger btn-sm deletestate" type="button" title="Delete State">'+'<span class="glyphicon glyphicon-trash"></span>'+"</button></li>";e("li.layerstate").removeClass("selstate").find(e("div")).remove();e("#statescontainer").append(r);e("#statescontainer > li:last").addClass("selstate").append(n);p.state=t;w("state");var i=C(p.layer,t);w("layer");i.type="text";_("text")});A()})();e(document).on("click","input:radio",function(){var t=e(this).attr("id");if(d[t]!=undefined){var n='Url: <a href="'+d[t]+'" target="_blank">'+d[t]+"</a>";e("#imageurl").html(n);e("#imagesaveok").removeAttr("disabled")}});e(document).on("click",".deletelayer",function(){var t=e(this).attr("data-id");var n=e(this);var r={};r.action="ibeffects_ajax_request";r.type="deleteimage";r.nonce=W3ExIBA.nonce;var i={};i.id=t;r.data=i;jQuery.ajax({type:"post",dataType:"json",url:W3ExIBA.ajaxurl,data:r,success:function(e){n.parents("tr:first").remove()},error:function(e){}})});var D;e("#newimage").click(function(t){t.preventDefault();if(D){D.open();return}D=wp.media.frames.file_frame=wp.media({title:"Choose Image",library:{type:"image"},button:{text:"Choose Image"},multiple:false,displaySettings:true,displayUserSettings:true});D.on("select",function(){var t=D.state().get("selection").first().toJSON();var n=t.sizes;var r="Select image size to continue<br /><br />";var i=0;d.length=0;var s="";for(key in n){var o=t.sizes[key];if(o==a)continue;if(key=="thumbnail")s=o.url;r+='<input type="radio" id="'+i+'" name="radioi"><label for="'+i+'"> ';r+=key.charAt(0).toUpperCase()+key.slice(1)+" - ( width: "+o.width+" ) ( height: "+o.height+" )</label> <br/>";d[i]=o.url;if(s=="")s=o.url;i++}if(s!=""){e("#imagedivback").css("background-image","url("+s+")")}r+='<div id="imageurl"></div>';e("#imagesizes").html(r);e("#newimagediv").css("visibility","visible").hide().fadeIn("slow",function(){e("html, body").animate({scrollTop:e(document).height()},"slow")});e("#imagesaveok").unbind("click");e("#imagesaveok").click(function(){var t={};t.action="ibeffects_ajax_request";t.type="newimage";t.nonce=W3ExIBA.nonce;var n={};var r=e("input[name=radioi]:checked").attr("id");if(d[r]!=undefined){n.img=d[r]}n.thumb=s;t.data=n;jQuery.ajax({type:"post",dataType:"json",url:W3ExIBA.ajaxurl,data:t,success:function(t){var n="<tr>"+"<td >"+t.id.id+"</td>"+"<td >"+t.id.shortcode+"</td>"+'<td ><div style="text-align:left;">'+t.id.infoto+"</div></td>"+'<td style="padding-top:2px;padding-bottom:6px;"><div class="centerblock">'+'<div class="imagebuttons">'+'<a class="btn btn-success btn-sm editlayer" href="admin.php?page=ibeffects&edit='+t.id.id+'">'+'<span class="glyphicon glyphicon-pencil"></span>'+"Edit</a>"+"<br/><br /><br />"+'<button data-id="'+t.id.id+'" class="btn btn-danger btn-sm deletelayer">'+'<span class="glyphicon glyphicon-trash"></span>'+"Delete</button>	"+"</div>"+'<div class="shownimages""><img src="'+s+'"></img>'+'</div><div style="clear:both;"> </div></div></td></tr>';e("#showimages > tbody:last").append(n);e("#newimage").removeAttr("disabled");e("#newimagediv").fadeOut()},error:function(t){e("#newimage").removeAttr("disabled");e("#newimagediv").fadeOut()}})});e("#imagesaveok").attr("disabled","disabled");e("#imagesavecancel").click(function(){e("#newimage").removeAttr("disabled");e("#newimagediv").fadeOut()});e("#newimage").attr("disabled","disabled")});D.open()});return{incConItems:function(){o++},finLoad:function(){u++}}}(jQuery)})